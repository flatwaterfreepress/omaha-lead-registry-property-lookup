<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Omaha Lead Lookup</title>

	<!-- Tailwind CDN -->  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
	  
	ul { border-radius: 10; list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
	li { padding: 0.5rem; cursor: pointer; font-size: 0.9rem; }
	li:hover { background: #efefef; }
	table { border-collapse: collapse; }
	th, td { padding: 1rem; border-bottom: 1px solid #eee; }
	tr:first-child td { border-top: 1px solid #eee; }
	
	#reset { display: none; }
	  </style>
</head>
<body class="bg-gray-50">
	<div class="container p-8 bg-white border rounded-lg">
    	
		<h1 class="font-bold text-2xl mb-2">Omaha Lead Lookup</h1>
  		<p class="text-gray-500 mb-8 text-md">The Environmental Protection Agency has sampled soil for lead at more than 40,000 properties across Omaha’s east side. Type in an address to see how much lead was measured there.</p>
  
  
  <div class="relative mb-4">
	  <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500">
		  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
	  </div>
	  <input type="text" id="search" placeholder="Enter address" class="w-full pl-12 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none text-md">
	</div>
	
	<p id="records" class="text-xs font-light text-gray-400 my-5"></p>
  
    
  <ul id="suggestions"></ul>
  <div id="details"></div>
  <button id="reset" class="border py-1 px-2 text-xs rounded-full mt-4 text-gray-500 hover:text-blue-600 border-gray-100">Reset</button>
	</div>
  
  <div id="footer" class="mt-5">
	  <p class="text-xs text-gray-500 mb-4 font-medium">Source: City of Omaha, Omaha Lead Registry</p>
	  
		  <p class="text-xs text-gray-400 font-light leading-[1.2rem] mb-4">To learn more about the City of Omaha’s lead program contact its Lead Information Office at (402) 731-3045 or <a href="mailto:contact@omahalead.org" class="underline"> contact@omahalead.org</a>. You can learn more about lead and access other services including potential home inspections from the Douglas County Health Department. More information on the Omaha Lead Superfund site and contacts for site managers can be found on the EPA’s website.</p>
  </div>

	
  <!-- Fuse.js for fuzzy search -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script>
	let data = [];   // will hold property records
	let fuse;
	// Load CSV converted to JSON
	fetch("data/lead.json")
	  .then(res => res.json())
	  .then(json => {
		data = json;
		fuse = new Fuse(data, { keys: ['address'], threshold: 0.3 });
	
		records.innerHTML = data.length.toLocaleString() + ' records in this database' ;
	  });

	const searchInput = document.getElementById('search');
	const suggestions = document.getElementById('suggestions');
	const details = document.getElementById('details');
	const message_text = document.getElementById('message');
	const resetBtn = document.getElementById('reset');
	const records = document.getElementById('records');


	searchInput.addEventListener('input', () => {
	  const query = searchInput.value.trim();
	  if (!query) {
		suggestions.innerHTML = '';
		return;
	  }
	  const results = fuse.search(query, { limit: 10 });
	  suggestions.innerHTML = results.map(r => `<li data-addr="${r.item.address}">${r.item.address}</li>`).join('');
	});

	suggestions.addEventListener('click', e => {
	  if (e.target.tagName === 'LI') {
		const addr = e.target.getAttribute('data-addr');
		const record = data.find(d => d.address === addr);
		showDetails(record);
		searchInput.value = addr;
		suggestions.innerHTML = '';
		resetBtn.style.display = 'inline-block';
	  }
	});
	
		  

	function showDetails(record) {
	  if (!record) return;
	  let table = '<div class="border shadow-sm mt-7 rounded-lg"><h3 class="text-2xl font-semibold p-6 bg-gray-900 text-white rounded-t-xl">' + record.address + '</h3><p id="message"></p><table class="table-auto w-full rounded-sm text-md"><tbody>';
	  
	  table += '<tr><td>Highest Test Result</td><td class="font-medium">' + record.soil_high_lead_result + ' ppm</td></tr><tr><td>Soil Test Sample Date</td><td class="font-medium">' + record.soil_sampled_date + '</td></tr><tr><td>Remediation Status</td><td class="font-medium">' + record.soil_remediation_status + '</td></tr><tr><td>Remediation Date</td><td class="font-medium">' + record.soil_remediation_date + '</td></tr></tbody></table>';
	  
	  let message_wrapper = '';

	  // Conditional message based on soil_high_lead_result
	  let message = '';
	  let cssClass = '';
	  const value = parseFloat(record.soil_high_lead_result);
	  const status = record.soil_remediation_status;
	  const sample_date = record.soil_sampled_date;
	  const remediation_date = record.soil_remediation_date;

	  if (!isNaN(value)) {
		if (value >= 400 && status == "Remediated" ) {
		  message = "<p>An EPA sample on " + sample_date + " found a portion of this property contained more than 400 ppm of lead. The property was remediated on " + remediation_date + ".</p><p class='mt-2'>Soil containing higher concentrations of lead than 400 ppm were removed and replaced with fill dirt.</p><p class='mt-2'>If you have more questions about remediation or this property call the city’s Lead Information Office at (402) 731-3045 or contact@omahalead.org. You can learn more about lead and access other services including potential home inspections from the Douglas County Health Department.</p>";
		  cssClass = "low";
		} else if (value >= 400 && status != "Remediated") {
		  message = "<p>An EPA sample on " + sample_date + " found a portion of this property contained more than 400 ppm of lead. This may qualify the owner for a free remediation from the City of Omaha. Contact the city’s Lead Information Office at (402) 731-3045 or contact@omahalead.org.</p><p class='mt-2'>You can learn more about lead and access other services including potential home inspections from the Douglas County Health Department.</p>";
		  cssClass = "medium";
		} else if (value >= 200 && value < 400) {
		  message = "<p>An EPA sample on " + sample_date + " found a portion of this property contained less than the required concentration of lead for cleanup in Omaha. It does have a concentration of more than 200 ppm.</p><p class='mt-2'>Under Oct. 16, 2025 EPA guidance, soil above 200 parts per million should be screened for further evaluation and can result in cleanup among other options to ensure protectiveness.</p><p class='mt-2'>If you have more questions about remediation or this property call the city’s Lead Information Office at (402) 731-3045 or contact@omahalead.org. You can learn more about lead and access other services including potential home inspections from the Douglas County Health Department.</p>";
		  cssClass = "high";
		} else if (value >= 100 && value < 200 ) {
			message = "<p>An EPA sample on " + sample_date + " found a portion of this property contained less than the required concentration of lead for cleanup in Omaha. It does have a concentration of more than 100 ppm.</p><p class='mt-2'>On Jan. 17 2024 the EPA, under the administration of President Joe Biden, advised that soil above 100 ppm should be evaluated when there are multiple exposures to lead through things like paint, service lines or historic use of leaded gasoline. On Oct. 16, 2025 the EPA under President Donald Trump, raised that guidance to 200 ppm whether an area has multiple exposures to lead or not.</p>";
		} else if (value < 100) {
			message = "An EPA sample on " + sample_date + " found a portion of this property contained less 100 ppm of lead in the soil. It is not recommended for further evaluation by any past or present federal guidance.";
		
		}
	  }

	  if (message) {
		  table += `<div class="text-sm p-4 mt-4 font-light text-gray-600 leading-5 message ${cssClass}"><p class="font-medium mb-2 text-lg text-gray-900">About this property</p><p>${message}</p></div>`;
		}

	  details.innerHTML = table;
	}

	resetBtn.addEventListener('click', () => {
	  searchInput.value = '';
	  details.innerHTML = '';
	  suggestions.innerHTML = '';
	  resetBtn.style.display = 'none';
	  searchInput.focus();
	});
  </script>
</body>
</html>
