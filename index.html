<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Omaha Address Lookup</title>
  <style>
	body { font-family: Arial, sans-serif; padding: 1rem; background: #eee; }
	.container { background: #fff; padding: 2rem;  }
	h2 { margin: 0; }
	.chatter { color: #444; }
	div.form { font-size: 0.8em; color: #777; margin-top: 2rem; }
	input { width: 100%; margin: 1rem 0; padding: 0.5rem; font-size: 1rem; }
	ul { border: 1px solid #eee; border-radius: 10; list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
	li { padding: 0.5rem; cursor: pointer; }
	li:hover { background: #eee; }
	table { margin-top: 1rem; border-collapse: collapse; width: 100%; }
	td, th { border: 1px solid #ddd; padding: 8px; }
	#reset { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem; display: none; }
	.message { font-size: 0.8em; margin-top: 1rem; padding: 0.75rem; border-radius: 4px; border: 1px solid #eee; }
	  </style>
</head>
<body>
	<div class="container">
  <h2>Omaha Address Lookup</h2>
  <p class="chatter">Chatter chatter chatter in here.</p>
  <input type="text" id="search" placeholder="Enter address...">
  <ul id="suggestions"></ul>
  <div id="details"></div>
  <button id="reset">Reset</button>
	</div>
  
  <div class="form">
	  <p><strong>Get your soil tested: </strong> We could put a link/message here and details about getting in touch Â»</p>
  </div>

	
  <!-- Fuse.js for fuzzy search -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <script>
	let data = [];   // will hold property records
	let fuse;

	// Load CSV converted to JSON
	fetch("data/lead.json")
	  .then(res => res.json())
	  .then(json => {
		data = json;
		fuse = new Fuse(data, { keys: ['address'], threshold: 0.3 });
	  });

	const searchInput = document.getElementById('search');
	const suggestions = document.getElementById('suggestions');
	const details = document.getElementById('details');
	const resetBtn = document.getElementById('reset');

	searchInput.addEventListener('input', () => {
	  const query = searchInput.value.trim();
	  if (!query) {
		suggestions.innerHTML = '';
		return;
	  }
	  const results = fuse.search(query, { limit: 10 });
	  suggestions.innerHTML = results.map(r => `<li data-addr="${r.item.address}">${r.item.address}</li>`).join('');
	});

	suggestions.addEventListener('click', e => {
	  if (e.target.tagName === 'LI') {
		const addr = e.target.getAttribute('data-addr');
		const record = data.find(d => d.address === addr);
		showDetails(record);
		searchInput.value = addr;
		suggestions.innerHTML = '';
		resetBtn.style.display = 'inline-block';
	  }
	});

	function showDetails(record) {
	  if (!record) return;
	  let table = '<table>';
	  for (const [key, value] of Object.entries(record)) {
		table += `<tr><th>${key}</th><td>${value}</td></tr>`;
	  }
	  table += '</table>';

	  // Conditional message based on soil_high_lead_result
	  let message = '';
	  let cssClass = '';
	  const value = parseFloat(record.soil_high_lead_result);

	  if (!isNaN(value)) {
		if (value < 200) {
		  message = "[Sample conditional message 1: Less than 200]";
		  cssClass = "low";
		} else if (value >= 200 && value < 400) {
		  message = "[Sample conditional message 2: Level 200-400]";
		  cssClass = "medium";
		} else if (value >= 400) {
		  message = "[Sample conditional message 3: Level 400+]";
		  cssClass = "high";
		}
	  }

	  if (message) {
		table += `<div class="message ${cssClass}">${message}</div>`;
	  }

	  details.innerHTML = table;
	}

	resetBtn.addEventListener('click', () => {
	  searchInput.value = '';
	  details.innerHTML = '';
	  suggestions.innerHTML = '';
	  resetBtn.style.display = 'none';
	  searchInput.focus();
	});
  </script>
</body>
</html>
